{% extends 'base.html.twig' %}

{% block title %} {{ parent() }} - Produit {% endblock %}

{% block body %}

    <article class="detailProduct LayoutProduct">
        <img class="detailProduct-pic" src="{{product.thumbnail}}"></img>
        <h2 class="detailProduct-title">{{product.name|capitalize}}</h2>
        <p class="detailProduct-desc">{{product.description}}</p>
        <small class="detailProduct-date">Publié le {{product.createdAt|date('d/m/Y')}}</small></br>
        <a href="{{ path('category_show', {'slug' : product.category.slug }) }}"><small class="productSticker-cat">Catégorie : {{product.category.name}}</small></a>
        <small class="detailProduct-price">Prix : {{format_price(product.price)}}</small>
    </article>

    {% if app.user %}
    <div class="formContainer LayoutProduct">
        <h3>Laissez un avis</h3>
        {{form_start(ReviewType, {'attr':{'class':'form', 'novalidate':'novalidate'}})}} {# ->balise <form> #}
            {{ form_widget(ReviewType, {'attr':{'class':'formChamp'}})}} {# ->les champs du formulaire #}
            <input class="submit" type="submit" value="Noter !"> {# On peut laisser le bouton en dur #}
        {{form_end(ReviewType)}} {# ->balise </form> #}
    </div>
    {% endif %}

    <h3 class="LayoutProduct">Les derniers avis</h3>

    <div class="Review LayoutProduct">
        {% for comment in comments %}
            {% if comment.reports|length<5 %}
                <div class="Comment">
                    <small>Publié par : {{comment.nickname}} le {{comment.createdAt|date('d/m/Y')}}</small>
                    {% if app.user.canRemoveReview(comment) %}
                        <a href="{{path('review_remove', {'slug':product.slug, 'id': comment.id})}}"><i class="far fa-trash-alt"></i></a>
                    {% endif %}
                    <p>Avis : {{comment.content}}</p>
                    <small class="grade">Note : {{comment.grade}}/5</small></br>
                    {% if app.user %}
                        {% if app.user.canReport(comment) %}
                            <a class="signal" href="{{path('review_report', {'slug':product.slug, 'id': comment.id} )}}"><i class="fas fa-exclamation signal"></i> Signaler cet avis</a>
                        {% endif %}
                        {% if app.user.canUnreport(comment) %}
                            <a class="unsignal" href="{{path('review_unreport', {'slug':product.slug, 'id': comment.id} )}}"><i class="fas fa-check unsignal"></i> Désignaler cet avis</a>
                        {% endif %}
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
    </div>
    
{% endblock %}